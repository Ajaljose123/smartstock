<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStock Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: Arial, sans-serif;
        }
        .sidebar {
            height: 100vh;
            background-color: #1f1f1f;
            padding-top: 20px;
            position: fixed;
            width: 230px;
        }
        .sidebar a {
            color: #ccc;
            text-decoration: none;
            display: block;
            padding: 12px 20px;
            margin: 5px 0;
        }
        .sidebar a:hover {
            background-color: #333;
            color: #fff;
        }
        .main-content {
            margin-left: 230px;
            padding: 20px;
        }
        .card {
            background-color: #1e1e1e;
            color: white;
            border: none;
        }
        .table {
            color: white;
        }
        .table thead {
            background-color: #333;
        }
        .low-stock {
            color: #ff4d4d;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h3 class="text-center" style="color:#ffd580">SmartStock</h3>
        <a href="{% url 'admin_dashboard' %}">Dashboard</a>
        <a href="#manage-products">Manage Products</a>
        <a href="{% url 'transactions' %}">Transactions</a>
        <a href="{% url 'manage_users' %}">Users</a>
        <a href="{% url 'supplier_management' %}">Supplier Management</a>
        <a href="{% url 'admin_supplier_requests' %}">Supplier Requests</a>
        <a href="{% url 'logout' %}">Logout</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h2>Admin Dashboard</h2>
        {% csrf_token %}

       {% if messages %}
    <div style="background:#333; padding:10px; border-radius:5px; margin-bottom:15px;">
        {% for message in messages %}
            <p style="color:{% if message.tags == 'warning' %}orange
                       {% elif message.tags == 'error' %}red
                       {% else %}lightgreen{% endif %};">
                {{ message }}
            </p>
        {% endfor %}
    </div>
{% endif %}

        <!-- Stats -->
        <div class="row mt-4">
            <div class="col-md-3">
                <div class="card p-3">
                    <h5>Total Products</h5>
                    <h2>{{ total_products }}</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3">
                    <h5>Total Stock</h5>
                    <h2>{{ total_stock }}</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3">
                    <h5>Low Stock Items</h5>
                    <h2>{{ low_stock_products.count }}</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card p-3">
                    <h5>Active Users</h5>
                    <h2>{{ active_users }}</h2>
                </div>
            </div>
            
        </div>

        <!-- Stock Transaction Form -->
        <div class="card mt-4 p-3">
            <h5>‚ûï Add Stock Transaction</h5>
            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="transaction_form" value="1">
                <div class="row">
                    <div class="col-md-3">
                        <label>Product</label>
                        <select name="product" class="form-control" required>
                            {% for p in products %}
                                <option value="{{ p.id }}">{{ p.name }} (Stock: {{ p.stock }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Type</label>
                        <select name="type" class="form-control" required>
                            <option value="in">Stock In</option>
                            <option value="out">Stock Out</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Quantity</label>
                        <input type="number" name="quantity" class="form-control" min="1" required>
                    </div>
                    <div class="col-md-3">
                        <label>Remarks</label>
                        <input type="text" name="remarks" class="form-control" placeholder="Optional">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">Save</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Low Stock Alerts -->
        <div class="card mt-4 p-3">
            <h5>‚ö†Ô∏è Low Stock Alerts</h5>
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Stock</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in low_stock_products %}
                        <tr>
                            <td>{{ product.name }}</td>
                            <td class="low-stock">{{ product.stock }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="2" class="text-center">No low stock products</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Chart -->
        <div class="card mt-4 p-4">
            <h5 class="mb-3">üìä Inventory Trends (Stock Value)</h5>
            <canvas id="inventoryChart" height="450"></canvas>
        </div>

        <!-- Recent Transactions -->
        <div class="card mt-4 p-3">
            <h5>üïí Recent Transactions</h5>
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Product</th>
                        <th>Type</th>
                        <th>Quantity</th>
                        <th>User</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in recent_transactions %}
                    <tr>
                        <td>{{ transaction.id }}</td>
                        <td>{{ transaction.product.name }}</td>
                        <td>{{ transaction.get_type_display }}</td>
                        <td>{{ transaction.quantity }}</td>
                        <td>{{ transaction.user.username }}</td>
                        <td>{{ transaction.date|date:"d M Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No recent transactions</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Manage Products -->
        <div class="card mt-4 p-3" id="manage-products">
            <h5>üì¶ Manage Products</h5>
            <!-- Low Stock Alerts -->
<div class="card mt-4 p-3">
    <h5>‚ö†Ô∏è Low Stock Alerts</h5>
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>Product</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in low_stock_products %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td class="low-stock">{{ product.stock }}</td>
                    <td>
                        <a href="{% url 'edit_product' product.id %}" class="btn btn-warning btn-sm">‚úè Edit</a>
                        <a href="{% url 'delete_product' product.id %}" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this product?');">
                           üóë Delete
                        </a>
                        
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3" class="text-center">No low stock products</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

            
   <div class="d-flex justify-content-end mb-3">
    <a href="{% url 'add_product' %}" class="btn btn-primary me-2" style="background:#ff7f50; border:none;">
        ‚ûï Add Product
    </a>
    <a href="{% url 'request_product' %}" class="btn btn-secondary" style="background:green; border:none;">
        üì® Request Order to Supplier
    </a>
</div>

            <!-- Product List -->
           <!-- Product List -->
<table class="table table-dark table-hover">
    <thead>
        <tr>
            <th>Name</th>
            <th>Category</th>
            <th>Stock</th>
            <th>Price</th>
            <th>Created</th>
            <th>Actions</th> <!-- NEW COLUMN -->
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.category }}</td>
            <td>
                {% if product.is_low_stock %}
                    <span class="text-danger">{{ product.stock }}</span>
                {% else %}
                    {{ product.stock }}
                {% endif %}
            </td>
            <td>{{ product.price }}</td>
            <td>{{ product.created_at|date:"d M Y H:i" }}</td>
            <td>
                <a href="{% url 'edit_product' product.id %}" class="btn btn-warning btn-sm">‚úè Edit</a>
                <a href="{% url 'delete_product' product.id %}" class="btn btn-danger btn-sm"
                   onclick="return confirm('Are you sure you want to delete this product?');">üóë Delete</a>
                <a href="{% url 'stock_history' product.id %}" class="btn btn-info btn-sm">üìä View History</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">No products available</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

        </div>
    </div>

    <!-- Chart.js Script -->
    <script>
const ctx = document.getElementById('inventoryChart').getContext('2d');

// Create gradient background for the line fill
const gradient = ctx.createLinearGradient(0, 0, 0, 300);
gradient.addColorStop(0, 'rgba(0, 255, 157, 0.5)');
gradient.addColorStop(1, 'rgba(0, 255, 157, 0)');

// Chart.js setup
new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ chart_labels|safe }},   // Product names
        datasets: [{
            label: 'üìà Stock Level',
            data: {{ chart_data|safe }},    // Stock numbers
            borderColor: '#00ff9d',
            backgroundColor: gradient,
            fill: true,
            tension: 0.4,                   // Smooth curved line
            pointBackgroundColor: '#00ff9d',
            pointBorderColor: '#fff',
            pointHoverRadius: 7,
            pointRadius: 5,
            borderWidth: 3,
            shadowColor: 'rgba(0,255,157,0.3)',
            shadowBlur: 10
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: true,
                labels: {
                    color: '#aaa',
                    font: { size: 14 }
                }
            },
            title: {
                display: true,
                text: 'üìä Inventory Trends (All Products)',
                color: '#fff',
                font: { size: 18, weight: 'bold' },
                padding: { top: 10, bottom: 20 }
            },
            tooltip: {
                backgroundColor: '#222',
                titleColor: '#00ff9d',
                bodyColor: '#fff',
                borderWidth: 1,
                borderColor: '#00ff9d',
                displayColors: false
            }
        },
        scales: {
            x: {
                ticks: {
                    color: '#ccc',
                    font: { size: 12 },
                    maxRotation: 60,
                    minRotation: 40
                },
                grid: {
                    color: 'rgba(255,255,255,0.1)'
                },
                title: {
                    display: true,
                    text: 'Products',
                    color: '#aaa'
                }
            },
            y: {
                ticks: {
                    color: '#ccc',
                    font: { size: 12 }
                },
                grid: {
                    color: 'rgba(255,255,255,0.1)'
                },
                title: {
                    display: true,
                    text: 'Stock Quantity',
                    color: '#aaa'
                }
            }
        }
    }
});
</script>


</body>
</html>
